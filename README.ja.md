# ほぼノリで実装したPBFT

このリポジトリには、Go言語で実装されたシンプルなPBFT（Practical Byzantine Fault Tolerance）コンセンサスアルゴリズムが含まれています。これは主に「バイブコーディング」（LLMとの対話的なコーディング）によって実装されました。

---

## 🚀 実行方法

プロジェクトは `makefile` を使用して、ビルド、デプロイ、実行を自動化しています。

### 前提条件
- Go 1.22+
- `make`
- `jq` (configのパース用)
- ノードへのSSHアクセス（複数マシンで実行する場合）
- ノードIPが設定された `cluster.conf`

### コマンド

1.  **ビルド**
    ```bash
    make build
    # またはローカル開発用
    go build -o pbft_server .
    ```

2.  **クラスターの起動**
    このコマンドは `cluster.conf` で定義されたマシン上でPBFTノードを起動します。
    ```bash
    make start
    ```

3.  **ベンチマークの実行**
    YCSB風のベンチマークスクリプトを実行します。
    ```bash
    make benchmark
    ```

4.  **クラスターの停止**
    ```bash
    make kill
    ```

5.  **ログとバイナリの削除**
    ```bash
    make clean
    ```

---

## 🚧 未実装部分

通常時の動作（PrePrepare -> Prepare -> Commit）は機能しますが、本番運用可能なPBFTとして重要な以下の機能が欠けています：

1.  **ビュー変更プロトコル**
    -   現在の実装は安定したプライマリリーダーを前提としています。リーダーの障害検知（タイムアウト）や新しいビューへの切り替え（ViewChange/NewViewメッセージ）のロジックがありません。

2.  **チェックポイントとログのGC**
    -   ログは無限に増加します。ログを切り詰めて古いエントリを破棄するチェックポイント機構がありません。

3.  **状態転送**
    -   遅延したノードが他のピアから欠損した状態やログを取得して追いつく機能がありません。

4.  **堅牢なクライアント**
    -   クライアントロジックはベンチマーク用にプライマリノードに埋め込まれています。リクエストのタイムアウト処理や新リーダーへのリダイレクトを行う適切な外部クライアントは実装されていません。

5.  **動的なメンバーシップ**
    -   クラスターサイズは静的で `cluster.conf` で定義されています。
